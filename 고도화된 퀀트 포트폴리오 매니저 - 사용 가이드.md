# 고도화된 퀀트 포트폴리오 매니저 - 사용 가이드

## 개요

이 고도화된 Streamlit 앱은 세 가지 주요 기능을 제공합니다:

1. **자동 최적화**: 선택한 종목들의 최적 비중을 자동으로 계산
2. **사용자 정의 백테스트**: 원하는 종목과 비중으로 직접 백테스트 수행
3. **리밸런싱 가이드**: 현재 보유 수량을 기반으로 리밸런싱 액션 제시

---

## 기능 상세 설명

### 1. 자동 최적화 (Tab 1)

#### 설정 항목
- **티커 입력**: 분석할 주식 종목 (쉼표로 구분)
- **시작일/종료일**: 백테스트 기간
- **초기 자본**: 포트폴리오 초기 투자액
- **리밸런싱 주기**: 
  - `None`: 리밸런싱 없음 (Buy and Hold)
  - `M`: 월간 리밸런싱
  - `Q`: 분기 리밸런싱
  - `Y`: 연간 리밸런싱
- **최적화 방법**:
  - `max_sharpe`: 최대 샤프 지수 (위험 대비 수익률 최대화)
  - `min_volatility`: 최소 변동성 (리스크 최소화)
  - `equal_weight`: 동일 가중치 (각 종목 동일 비중)

#### 출력 결과
- **성과 지표**: 총 수익률, 연환산 수익률, 샤프 지수, 최대 낙폭(MDD)
- **성과 분석 탭**:
  - 포트폴리오 가치 추이 차트 (CAGR 표시)
  - 낙폭(Drawdown) 영역 차트
  - 일간 수익률 분포 히스토그램
- **자산 배분 탭**:
  - 최적화된 비중 파이 차트
  - 각 종목별 비중 테이블
  - 현재가 기준 추천 매수 수량
- **데이터 탭**:
  - 주가 데이터 조회
  - 자산 간 상관관계 히트맵

---

### 2. 사용자 정의 백테스트 (Tab 2)

사용자가 직접 정한 종목과 비중으로 백테스트를 수행합니다.

#### 입력 방법
```
포트폴리오 구성:
- 티커: AAPL, MSFT, GOOGL
- 각 종목의 비중(%) 입력

백테스트 설정:
- 시작일, 종료일
- 초기 자본
- 리밸런싱 주기
```

#### 예시
```
티커: AAPL, MSFT, GOOGL
AAPL 비중: 50%
MSFT 비중: 30%
GOOGL 비중: 20%
```

#### 출력 결과
- 자동 최적화와 동일한 성과 지표 및 차트 제공
- 사용자가 정한 비중의 성과를 직접 확인 가능

---

### 3. 리밸런싱 가이드 (Tab 3)

현재 보유 수량을 입력하면 목표 비중에 맞추기 위한 구체적인 매수/매도 액션을 제시합니다.

#### 입력 방법

**현재 보유 수량** (형식: `TICKER:SHARES`)
```
AAPL:10
MSFT:5
GOOGL:3
```

**목표 비중** (형식: `TICKER:WEIGHT%`)
```
AAPL:50
MSFT:30
GOOGL:20
```

#### 출력 결과

**요약 정보**
- 포트폴리오 총 가치: 현재 보유 자산의 총 시장가
- 필요한 현금: 매수에 필요한 추가 현금
- 예상 거래 비용: 거래 수수료 (0.1% 기준)
- 순 현금 필요: 필요한 현금 + 거래 비용

**리밸런싱 액션 테이블**
| 항목 | 설명 |
|------|------|
| Ticker | 종목명 |
| Current Shares | 현재 보유 수량 |
| Current Price | 현재 주가 |
| Current Value | 현재 보유 가치 |
| Current Weight | 현재 비중 |
| Target Weight | 목표 비중 |
| Target Shares | 목표 수량 |
| Shares to Buy/Sell | 매수/매도 수량 (음수는 매도) |
| Transaction Value | 거래 금액 |

**거래 요약**
- 매수 종목 목록 및 수량
- 매도 종목 목록 및 수량

---

## 주요 지표 설명

### CAGR (Compound Annual Growth Rate)
연평균 복합 성장률로, 투자 기간 동안의 연평균 수익률을 나타냅니다.
```
CAGR = (최종 가치 / 초기 가치)^(1/년수) - 1
```

### Sharpe Ratio (샤프 지수)
위험 대비 수익률을 나타내는 지표입니다. 값이 클수록 좋습니다.
```
Sharpe Ratio = (연환산 수익률 - 무위험 수익률) / 연환산 변동성
```

### MDD (Maximum Drawdown)
투자 기간 중 최대 손실률을 나타냅니다. 음수 값으로 표시됩니다.
```
MDD = (최저 가치 - 최고 가치) / 최고 가치
```

### Volatility (변동성)
연환산 표준편차로, 포트폴리오의 변동성을 나타냅니다.

### Correlation (상관관계)
두 자산의 가격 움직임이 얼마나 함께 움직이는지를 나타냅니다.
- 1에 가까울수록 같은 방향으로 움직임
- -1에 가까울수록 반대 방향으로 움직임
- 0에 가까울수록 독립적

---

## 사용 팁

### 팁 1: 최적화 방법 선택
- **Max Sharpe**: 위험 대비 수익률을 최대화하고 싶을 때
- **Min Volatility**: 변동성을 최소화하고 싶을 때 (보수적 투자)
- **Equal Weight**: 간단한 포트폴리오를 원할 때

### 팁 2: 리밸런싱 주기
- **None**: 초기 비중을 유지하는 전략 (Buy and Hold)
- **M (월간)**: 자주 리밸런싱하여 비용 증가하지만 비중 유지
- **Q (분기)**: 적절한 수준의 리밸런싱
- **Y (연간)**: 최소한의 리밸런싱으로 거래 비용 절감

### 팁 3: 상관관계 활용
- 상관관계가 낮은 자산들을 조합하면 포트폴리오 위험 감소
- 상관관계 히트맵에서 낮은 값(파란색)을 찾아 조합하기

### 팁 4: 리밸런싱 비용 고려
- 거래 비용이 높으면 리밸런싱 주기를 길게 설정
- 소액 투자자는 리밸런싱 비용이 수익률에 큰 영향을 미칠 수 있음

---

## 실행 방법

### 1. 기본 설정
```bash
cd /home/ubuntu/quant_app
source venv/bin/activate
```

### 2. 앱 실행
```bash
streamlit run app_advanced.py
```

### 3. 브라우저에서 접속
```
http://localhost:8501
```

---

## 주의사항

1. **데이터 정확성**: Yahoo Finance에서 제공하는 데이터를 사용하므로 실시간 데이터가 아닙니다.
2. **거래 비용**: 기본 0.1% 수수료로 계산되며, 실제 거래 비용과 다를 수 있습니다.
3. **과거 성과**: 백테스트 결과는 과거 성과이며, 미래 성과를 보장하지 않습니다.
4. **세금**: 세금은 계산에 포함되지 않습니다.
5. **슬리피지**: 실제 거래 시 가격 변동(슬리피지)은 고려되지 않습니다.

---

## 문제 해결

### Q: "데이터를 가져오지 못했습니다" 오류
- 티커가 정확한지 확인하세요 (예: AAPL, MSFT)
- 인터넷 연결을 확인하세요
- 야후 파이낸스 서버 상태를 확인하세요

### Q: 리밸런싱 가이드에서 "현재 주가를 가져오지 못했습니다" 오류
- 입력한 티커가 정확한지 확인하세요
- 인터넷 연결을 확인하세요

### Q: 백테스트 결과가 이상해요
- 시작일과 종료일이 올바른지 확인하세요
- 종목이 해당 기간에 거래되었는지 확인하세요
- 비중의 합이 100%인지 확인하세요

---

## 버전 정보

- **Streamlit**: 1.28.0 이상
- **pandas**: 1.5.0 이상
- **yfinance**: 0.2.0 이상
- **plotly**: 5.0.0 이상
- **pypfopt**: 1.5.0 이상

---

## 라이선스

이 프로젝트는 MIT 라이선스 하에 배포됩니다.
